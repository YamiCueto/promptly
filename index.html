<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Promptly - AI Chat Interface</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <!-- CSS Modular -->
    <link rel="stylesheet" href="css/main.css">
    <!-- Fallback al CSS monol√≠tico si hay problemas con imports -->
    <!-- <link rel="stylesheet" href="css/styles.css"> -->
    
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <meta name="description" content="Interfaz de chat AI que se conecta a Ollama local y APIs externas">
    
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
                        <div class="header-content">
                <div class="logo">
                    <h1><span class="material-icons">auto_awesome</span> Promptly</h1>
                    <span class="subtitle">Chat AI Assistant</span>
                </div>
                
                <!-- Model Selector in Header -->
                <div class="model-selector">
                    <span class="material-icons model-icon">psychology</span>
                    <label for="headerModelSelect" class="model-label">Modelo:</label>
                    <select id="headerModelSelect" class="model-select">
                        <option value="">Cargando modelos...</option>
                    </select>
                </div>
                
                <div class="header-controls">
                    <button class="btn-secondary" id="themeToggleBtn">
                        <span class="material-icons">dark_mode</span>
                        <span class="btn-text">Tema Oscuro</span>
                    </button>
                    <button class="btn-secondary" id="settingsBtn">
                        <span class="material-icons">settings</span>
                        <span class="btn-text">Configuraci√≥n</span>
                    </button>
                    <button class="btn-secondary" id="clearChatBtn">
                        <span class="material-icons">delete_outline</span>
                        <span class="btn-text">Limpiar Chat</span>
                    </button>
                    <button class="btn-secondary" id="exportChatBtn">
                        <span class="material-icons">file_download</span>
                        <span class="btn-text">Exportar</span>
                    </button>
                </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Settings Panel -->
            <div class="settings-panel" id="settingsPanel">
                <div class="settings-content">
                    <h3>Configuraci√≥n de AI</h3>
                    
                    <div class="setting-group">
                        <label for="providerSelect">Proveedor:</label>
                        <select id="providerSelect" class="form-select">
                            <option value="ollama">Ollama (Local)</option>
                            <option value="openai">OpenAI</option>
                            <option value="anthropic">Anthropic (Claude)</option>
                            <option value="groq">Groq</option>
                        </select>
                    </div>

                    <div class="setting-group" id="ollamaSettings">
                        <label for="ollamaUrl">URL de Ollama:</label>
                        <input type="text" id="ollamaUrl" class="form-input" value="http://localhost:11434" placeholder="http://localhost:11434">
                        
                        <label for="ollamaModel">Modelo:</label>
                        <select id="ollamaModel" class="form-select">
                            <option value="llama3.2">llama3.2</option>
                            <option value="llama3.1">llama3.1</option>
                            <option value="mistral">mistral</option>
                            <option value="codellama">codellama</option>
                            <option value="phi3">phi3</option>
                        </select>
                        <button type="button" id="refreshModelsBtn" class="btn-secondary btn-sm">
                            <span class="material-icons">refresh</span>
                            Actualizar Modelos
                        </button>
                    </div>

                    <div class="setting-group hidden" id="apiSettings">
                        <label for="apiKey">API Key:</label>
                        <input type="password" id="apiKey" class="form-input" placeholder="Ingresa tu API key">
                        
                        <label for="apiModel">Modelo:</label>
                        <select id="apiModel" class="form-select">
                            <!-- Se poblar√° din√°micamente seg√∫n el proveedor -->
                        </select>
                    </div>

                    <div class="setting-group">
                        <label for="temperature">Temperatura:</label>
                        <input type="range" id="temperature" min="0" max="2" step="0.1" value="0.7" class="form-range">
                        <span id="temperatureValue">0.7</span>
                    </div>

                    <div class="setting-group">
                        <label for="maxTokens">M√°x. Tokens:</label>
                        <input type="number" id="maxTokens" class="form-input" value="2048" min="1" max="8192">
                    </div>

                    <div class="settings-actions">
                        <button type="button" id="saveSettingsBtn" class="btn-primary">Guardar</button>
                        <button type="button" id="closeSettingsBtn" class="btn-secondary">Cerrar</button>
                    </div>
                </div>
            </div>

            <!-- Chat Container -->
            <div class="chat-container">
                <div class="chat-messages" id="chatMessages">
                    <div class="welcome-message">
                        <div class="welcome-content">
                            <h2>¬°Bienvenido a Promptly! üöÄ</h2>
                            <p>Tu interfaz de chat AI que se conecta tanto a Ollama local como a APIs externas.</p>
                            <div class="features">
                                <div class="feature">
                                    <span class="feature-icon">üè†</span>
                                    <span>Ollama Local</span>
                                </div>
                                <div class="feature">
                                    <span class="feature-icon">‚òÅÔ∏è</span>
                                    <span>APIs Externas</span>
                                </div>
                                <div class="feature">
                                    <span class="feature-icon">üé®</span>
                                    <span>Interfaz Moderna</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Input Area -->
        <footer class="input-area">
            <div class="input-container">
                <div class="input-wrapper">
                    <textarea 
                        id="messageInput" 
                        class="message-input" 
                        placeholder="Escribe tu mensaje aqu√≠..."
                        rows="1"
                    ></textarea>
                    <button id="sendBtn" class="send-btn" disabled>
                        <span class="material-icons">send</span>
                    </button>
                </div>
                <div class="input-info">
                    <span class="connection-status" id="connectionStatus">
                        <span class="status-dot"></span>
                        Configurar conexi√≥n
                    </span>
                </div>
            </div>
        </footer>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay hidden" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <p>Enviando mensaje...</p>
    </div>

    <!-- Setup Wizard -->
    <div class="setup-wizard hidden" id="setupWizard">
        <div class="wizard-backdrop"></div>
        <div class="wizard-container">
            <div class="wizard-header">
                <h2 id="wizardTitle">üßô‚Äç‚ôÇÔ∏è Configuraci√≥n Inicial de Promptly</h2>
                <div class="wizard-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="wizardProgress"></div>
                    </div>
                    <span class="progress-text" id="wizardProgressText">Paso 1 de 4</span>
                </div>
            </div>
            
            <div class="wizard-content">
                <!-- Step 1: Welcome -->
                <div class="wizard-step active" data-step="1">
                    <div class="step-icon">üöÄ</div>
                    <h3>¬°Bienvenido a Promptly!</h3>
                    <p>Te guiar√© a trav√©s de la configuraci√≥n inicial para que puedas comenzar a chatear con IA de inmediato.</p>
                    <div class="feature-highlights">
                        <div class="highlight">
                            <span class="material-icons">psychology</span>
                            <span>Conecta con Ollama local o APIs externas</span>
                        </div>
                        <div class="highlight">
                            <span class="material-icons">auto_awesome</span>
                            <span>Auto-scroll inteligente y tema personalizable</span>
                        </div>
                        <div class="highlight">
                            <span class="material-icons">speed</span>
                            <span>Interfaz r√°pida y responsive</span>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Provider Selection -->
                <div class="wizard-step" data-step="2">
                    <div class="step-icon">üîå</div>
                    <h3>Selecciona tu Proveedor de IA</h3>
                    <p>¬øC√≥mo quieres conectarte a los modelos de IA?</p>
                    <div class="provider-options">
                        <div class="provider-card" data-provider="ollama">
                            <div class="provider-icon">üè†</div>
                            <h4>Ollama Local</h4>
                            <p>Ejecuta modelos en tu computadora</p>
                            <ul>
                                <li>‚úÖ Privado y seguro</li>
                                <li>‚úÖ Sin l√≠mites de uso</li>
                                <li>‚úÖ Funciona offline</li>
                                <li>‚ö†Ô∏è Requiere instalaci√≥n</li>
                            </ul>
                        </div>
                        <div class="provider-card" data-provider="external">
                            <div class="provider-icon">‚òÅÔ∏è</div>
                            <h4>APIs Externas</h4>
                            <p>Conecta con OpenAI, Anthropic, Groq</p>
                            <ul>
                                <li>‚úÖ Configuraci√≥n r√°pida</li>
                                <li>‚úÖ Modelos m√°s potentes</li>
                                <li>‚úÖ Siempre actualizado</li>
                                <li>‚ö†Ô∏è Requiere API key</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Step 3a: Ollama Configuration -->
                <div class="wizard-step" data-step="3" data-provider="ollama">
                    <div class="step-icon">‚öôÔ∏è</div>
                    <h3>Configuraci√≥n de Ollama</h3>
                    <p>Vamos a conectar con tu instalaci√≥n local de Ollama.</p>
                    
                    <div class="config-section">
                        <label for="wizardOllamaUrl">URL de Ollama:</label>
                        <input type="text" id="wizardOllamaUrl" class="wizard-input" value="http://localhost:11434" placeholder="http://localhost:11434">
                        <small>Normalmente es localhost:11434 si tienes Ollama instalado localmente</small>
                    </div>

                    <div class="ollama-status" id="ollamaWizardStatus">
                        <span class="status-dot"></span>
                        <span class="status-text">Haz clic en "Probar Conexi√≥n" para verificar</span>
                    </div>

                    <button type="button" class="btn-primary" id="testOllamaConnection">
                        <span class="material-icons">wifi_find</span>
                        Probar Conexi√≥n
                    </button>

                    <div class="ollama-help hidden" id="ollamaHelp">
                        <h4>üí° ¬øNo tienes Ollama instalado?</h4>
                        <ol>
                            <li>Descarga Ollama desde <a href="https://ollama.ai" target="_blank">ollama.ai</a></li>
                            <li>Inst√°lalo en tu sistema</li>
                            <li>Ejecuta: <code>ollama pull llama3.2</code></li>
                            <li>Inicia el servidor: <code>ollama serve</code></li>
                        </ol>
                    </div>
                </div>

                <!-- Step 3b: External API Configuration -->
                <div class="wizard-step" data-step="3" data-provider="external">
                    <div class="step-icon">üîë</div>
                    <h3>Configuraci√≥n de API Externa</h3>
                    <p>Selecciona tu proveedor de IA preferido y configura tu API key.</p>
                    
                    <div class="config-section">
                        <label for="wizardApiProvider">Proveedor:</label>
                        <select id="wizardApiProvider" class="wizard-input">
                            <option value="openai">OpenAI (GPT-4, GPT-3.5)</option>
                            <option value="anthropic">Anthropic (Claude)</option>
                            <option value="groq">Groq (Llama, Mixtral)</option>
                        </select>
                    </div>

                    <div class="config-section">
                        <label for="wizardApiKey">API Key:</label>
                        <input type="password" id="wizardApiKey" class="wizard-input" placeholder="sk-...">
                        <small>Tu API key se almacena localmente en tu navegador</small>
                    </div>

                    <div class="api-links">
                        <h4>üîó Obtener API Keys:</h4>
                        <div class="link-grid">
                            <a href="https://platform.openai.com/api-keys" target="_blank" class="api-link">
                                <span class="material-icons">launch</span>
                                OpenAI API Keys
                            </a>
                            <a href="https://console.anthropic.com/" target="_blank" class="api-link">
                                <span class="material-icons">launch</span>
                                Anthropic Console
                            </a>
                            <a href="https://console.groq.com/keys" target="_blank" class="api-link">
                                <span class="material-icons">launch</span>
                                Groq API Keys
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Completion -->
                <div class="wizard-step" data-step="4">
                    <div class="step-icon">üéâ</div>
                    <h3>¬°Configuraci√≥n Completada!</h3>
                    <p>Todo est√° listo para comenzar a usar Promptly.</p>
                    
                    <div class="completion-summary" id="completionSummary">
                        <!-- Se llena din√°micamente con la configuraci√≥n -->
                    </div>

                    <div class="next-steps">
                        <h4>üìã Pr√≥ximos pasos:</h4>
                        <ul>
                            <li>‚ú® Escribir tu primer mensaje en el chat</li>
                            <li>üé® Personalizar el tema (claro/oscuro)</li>
                            <li>üì§ Exportar conversaciones cuando quieras</li>
                            <li>‚öôÔ∏è Cambiar configuraci√≥n desde el panel lateral</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="wizard-footer">
                <button type="button" class="btn-secondary" id="wizardBack" disabled>
                    <span class="material-icons">arrow_back</span>
                    Anterior
                </button>
                <button type="button" class="btn-primary" id="wizardNext">
                    Siguiente
                    <span class="material-icons">arrow_forward</span>
                </button>
                <button type="button" class="btn-primary hidden" id="wizardFinish">
                    <span class="material-icons">check</span>
                    ¬°Empezar a Chatear!
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/providers.js"></script>
    <script src="js/chat.js"></script>
    <script src="js/wizard.js"></script>
    <script src="js/app.js"></script>
</body>
</html>